# ID: NP1-01

## Title

Rate-limit strategy for high-traffic endpoints + ops metrics

## Context

Rate limiting exists (`lib/server/rateLimit.ts`) but needs an explicit strategy for:

- analytics ingest
- admin endpoints
- any future auth/subscription endpoints
  At 100k DAU, lack of guardrails risks abuse and instability.

## Steps

1. Define per-endpoint limits and keys (IP + user/session when available).
2. Add rate-limit integration to critical APIs.
3. Emit lightweight metrics (already supported by `rate_limit_metrics`) and document dashboards/log review.

## Acceptance Criteria

- Abuse-resistant endpoints under load.
- Rate limit blocks are observable.

## Dependencies

- DB tables for rate limits/metrics must exist when enabled.

## Files to modify

- `lib/server/rateLimit.ts`
- `app/api/analytics/route.ts`
- `app/api/admin/*`
- `scripts/db/schema.sql`
