# ID: NP0-02

## Title

Deploy-blocking gate: P0 done + lint/test/build + Lighthouse + security audit

## Context

Deployment must be forbidden unless all launch blockers are done and verification passes. Currently CI has multiple workflows (`ci-core.yml`, Lighthouse, security audit), but there is no single “release gate” that also checks the repo’s own task completion policy (P0 done).

## Steps

1. Define a machine-checkable contract for task completion:
   - parse `tasks/*.md` and require `## Status` = `DONE` for all `P0-*`
2. Add a new CI job/workflow (or extend `ci-core.yml`) that is required for deploy:
   - runs `pnpm lint`
   - runs `pnpm test:ci`
   - runs `pnpm build`
   - runs `pnpm lighthouse:ci`
   - runs `pnpm security:scan`
   - runs the “P0 status gate” script
3. Ensure deploy workflows (`deploy-staging.yml`, `deploy-production.yml`) depend on this gate.

## Acceptance Criteria

- A single required check blocks deployment when any condition fails.
- Deploy workflows cannot run (or fail early) if P0 tasks are not DONE.

## Dependencies

- None.

## Files to modify

- `.github/workflows/ci-core.yml`
- `.github/workflows/deploy-staging.yml`
- `.github/workflows/deploy-production.yml`
- `scripts/quality/*` (new P0 status gate)
- `TASKS.md`, `tasks/*` (contract fields)
