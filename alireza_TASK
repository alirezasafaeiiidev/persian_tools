# Alireza Manual Task List (Outside Repo/Local)

Last updated: 2026-02-13

## Operational Note (Today)

1. Strict post-deploy verification was re-run and passed for production (`base_url=https://persiantoolbox.ir`).
2. Some checks can still fail from specific client networks due to local resolver returning NXDOMAIN for apex/staging while public resolvers are healthy.
3. Root cause evidence collected: `.ir` authoritative name servers are inconsistent for `persiantoolbox.ir` (some return delegation to Arvan NS, some return NXDOMAIN), which explains intermittent resolver behavior.

## Operational Note (Automation Update 2026-02-13)

1. Local quality/contract gates were re-run and passed:
   - `pnpm ci:contracts`
   - `pnpm ci:quick`
2. Release/deploy gates were re-run and passed with fresh artifacts:
   - `docs/deployment/reports/readiness-2026-02-13T21-17-51-422Z.json`
   - `docs/release/reports/rc-gates-2026-02-13T21-18-22-309Z.json`
   - `docs/release/reports/launch-smoke-2026-02-13T21-19-14-957Z.json`
3. Strict post-deploy reports were generated and passed for:
   - `https://persiantoolbox.ir`
   - `https://www.persiantoolbox.ir`
   - `https://staging.persiantoolbox.ir`
4. Public DNS checks via resolvers `8.8.8.8` and `9.9.9.9` resolve all three hosts to `185.3.124.93`.

## P0 - Must Do First

1. In Arvan DNS, confirm required records exist and are correct in the active zone:
   - `A @ -> 185.3.124.93`
   - `A www -> 185.3.124.93` (or `CNAME www -> @`)
   - `A staging -> 185.3.124.93`
2. In Arvan SSL/TLS settings, enable certificate issuance for:
   - `persiantoolbox.ir`
   - `www.persiantoolbox.ir`
   - `staging.persiantoolbox.ir`
3. Verify origin HTTPS on VPS is healthy for SNI hosts (current probe shows TLS handshake EOF on `:443` while HTTP host-based routing works).
4. Set CDN/SSL mode to `Full (strict)` only after origin HTTPS/certificate is confirmed valid.
5. Replace all placeholder production secrets (`change_me`) with real secure values:
   - `DATABASE_URL` password
   - `SUBSCRIPTION_WEBHOOK_SECRET`
   - `ADMIN_EMAIL_ALLOWLIST`
   - `ANALYTICS_INGEST_SECRET` (if analytics ingest is enabled)
6. Apply same real DB password in PostgreSQL user `persian_tools_prod` on VPS.

## P1 - Immediately After DNS Is Active

1. Verify public DNS resolution from at least two networks (not only panel status):
   - `persiantoolbox.ir`
   - `www.persiantoolbox.ir`
   - `staging.persiantoolbox.ir`
2. Manually verify public access:
   - `https://persiantoolbox.ir`
   - `https://www.persiantoolbox.ir`
   - `https://staging.persiantoolbox.ir`
3. Re-run production deploy with strict checks on domain:
   - workflow: `deploy-production`
   - input: `base_url=https://persiantoolbox.ir`
   - input: `post_report_strict=true`
4. Confirm admin route protection behavior from public domain: `/admin/site-settings`.

## P2 - Stability / Business / Ops

1. Set reminders for domain + CDN renewal dates (prevent accidental expiry).
2. Choose and activate alert destination (email/Telegram/SMS) for uptime + backup failures.
3. If needed, purchase/upgrade CDN/WAF plan based on expected traffic.
4. Keep an off-server copy of daily DB backups (object storage or secondary server).

## Done By Codex (No Action Needed From You Now)

1. Staging deploy is green and running.
2. Production deploy is green and running on VPS (latest stable release kept via rollback policy).
3. Automatic daily production DB backup cron is configured.
4. Deploy workflows and runbook were updated for DNS propagation phase and strict re-check flow.
5. Strict production verification was executed after domain activation claim (run `21910200157`) and failed on public fetch checks, then auto-rollback restored previous healthy release.
6. Strict post-deploy was re-run locally with:
   - `node scripts/deploy/generate-post-deploy-report.mjs --base-url=https://persiantoolbox.ir --strict=true`
   - Result: smoke `passed`, headers `passed`, decision `Keep rollout`.
