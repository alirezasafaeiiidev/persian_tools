<!doctype html>
<html lang="fa" dir="rtl">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Roadmap Board — Persian Tools</title>
    <style>
      :root {
        --bg-a: #f4f7ff;
        --bg-b: #eefaf6;
        --surface: #ffffff;
        --surface-soft: #f8fafc;
        --text: #0f172a;
        --muted: #5b6472;
        --primary: #0f766e;
        --primary-soft: #dff8f2;
        --done: #15803d;
        --open: #b45309;
        --border: #dbe3ef;
        --shadow: 0 12px 35px rgba(15, 23, 42, 0.08);
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        font-family: "IRANSansX", "Vazirmatn", "Segoe UI", Tahoma, sans-serif;
        color: var(--text);
        background:
          radial-gradient(circle at 10% 0%, #d8e5ff 0%, transparent 40%),
          radial-gradient(circle at 90% 0%, #dcfce7 0%, transparent 36%),
          linear-gradient(180deg, var(--bg-a) 0%, var(--bg-b) 100%);
        min-height: 100vh;
      }

      .container {
        width: min(1500px, calc(100% - 24px));
        margin-inline: auto;
        padding: 20px 0 28px;
      }

      .hero {
        border: 1px solid rgba(255, 255, 255, 0.8);
        border-radius: 20px;
        background: linear-gradient(125deg, rgba(255, 255, 255, 0.94), rgba(245, 255, 251, 0.9));
        box-shadow: var(--shadow);
        padding: 20px;
      }

      .hero-head {
        display: flex;
        align-items: flex-start;
        justify-content: space-between;
        gap: 12px;
        flex-wrap: wrap;
      }

      .hero h1 {
        margin: 0;
        font-size: clamp(1.25rem, 2.3vw, 1.7rem);
      }

      .hero p {
        margin: 8px 0 0;
        color: var(--muted);
        font-size: 0.92rem;
      }

      .badge {
        border: 1px solid #b9efe2;
        background: #e9fdf7;
        color: #0a5f57;
        padding: 8px 12px;
        border-radius: 999px;
        font-size: 0.8rem;
        font-weight: 700;
      }

      .controls,
      .snapshot-controls,
      .filters,
      .phase-nav {
        margin-top: 12px;
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
      }

      button,
      select,
      input[type='search'],
      input[type='text'] {
        border: 1px solid var(--border);
        background: var(--surface);
        color: var(--text);
        border-radius: 12px;
        padding: 8px 12px;
        font: inherit;
        font-size: 0.82rem;
      }

      input[type='search'],
      input[type='text'] {
        min-width: 220px;
      }

      button {
        cursor: pointer;
        transition: 120ms ease;
      }

      button:hover {
        border-color: #9ecbc4;
        transform: translateY(-1px);
      }

      .btn-primary {
        background: var(--primary);
        border-color: var(--primary);
        color: #fff;
      }

      .filter-btn.active,
      .phase-btn.active,
      .status-btn.active {
        color: #fff;
        border-color: var(--primary);
        background: var(--primary);
      }

      .status-switch {
        display: inline-flex;
        border: 1px solid var(--border);
        border-radius: 12px;
        overflow: hidden;
      }

      .status-btn {
        border: 0;
        border-inline-end: 1px solid var(--border);
        border-radius: 0;
      }

      .status-btn:last-child {
        border-inline-end: 0;
      }

      .dashboard {
        margin-top: 14px;
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 10px;
      }

      .kpi {
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: 16px;
        padding: 12px;
        box-shadow: 0 8px 20px rgba(15, 23, 42, 0.05);
      }

      .kpi-title {
        color: var(--muted);
        font-size: 0.78rem;
      }

      .kpi-value {
        margin-top: 8px;
        font-size: 1.3rem;
        font-weight: 800;
      }

      .kpi-progress {
        margin-top: 10px;
        height: 7px;
        border-radius: 999px;
        background: #edf2f7;
        overflow: hidden;
      }

      .kpi-progress > span {
        display: block;
        height: 100%;
        width: 0%;
        background: linear-gradient(90deg, #10b981, #0f766e);
      }

      .layout {
        margin-top: 14px;
        display: grid;
        grid-template-columns: 290px 1fr;
        gap: 12px;
      }

      .sidebar,
      .board-wrap {
        background: rgba(255, 255, 255, 0.8);
        backdrop-filter: blur(5px);
        border: 1px solid rgba(218, 226, 240, 0.8);
        border-radius: 16px;
        box-shadow: 0 12px 24px rgba(15, 23, 42, 0.05);
      }

      .sidebar {
        padding: 12px;
        position: sticky;
        top: 10px;
        align-self: start;
      }

      .sidebar h3 {
        margin: 4px 0 10px;
        font-size: 0.95rem;
      }

      .phase-nav {
        margin-top: 0;
        display: grid;
        gap: 6px;
      }

      .phase-btn {
        width: 100%;
        text-align: start;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .phase-btn .count {
        color: var(--muted);
        font-size: 0.75rem;
      }

      .phase-btn.active .count {
        color: #e6f7f4;
      }

      .board-wrap {
        padding: 12px;
      }

      .board {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(270px, 1fr));
        gap: 10px;
      }

      .column {
        border: 1px solid var(--border);
        background: var(--surface);
        border-radius: 14px;
        padding: 10px;
      }

      .column-header {
        border-bottom: 1px dashed #d6dee9;
        padding-bottom: 8px;
        margin-bottom: 8px;
      }

      .column h2 {
        margin: 0;
        font-size: 0.98rem;
      }

      .column-meta {
        margin-top: 8px;
        display: flex;
        align-items: center;
        gap: 8px;
        color: var(--muted);
        font-size: 0.76rem;
      }

      .mini-progress {
        flex: 1;
        height: 6px;
        background: #edf2f7;
        border-radius: 999px;
        overflow: hidden;
      }

      .mini-progress > span {
        display: block;
        height: 100%;
        width: 0%;
        background: linear-gradient(90deg, #22c55e, #15803d);
      }

      .task {
        display: flex;
        align-items: start;
        gap: 8px;
        padding: 7px;
        border: 1px solid transparent;
        border-radius: 10px;
      }

      .task:hover {
        border-color: #dde7f3;
        background: var(--surface-soft);
      }

      .task input[type='checkbox'] {
        margin-top: 3px;
        inline-size: 16px;
        block-size: 16px;
        accent-color: var(--primary);
      }

      .task label {
        font-size: 0.84rem;
        line-height: 1.6;
      }

      .task.done label {
        color: #64748b;
        text-decoration: line-through;
      }

      .meta {
        display: block;
        margin-top: 3px;
        color: var(--muted);
        font-size: 0.74rem;
      }

      .tag {
        display: inline-flex;
        align-items: center;
        padding: 2px 8px;
        border-radius: 999px;
        margin-inline-start: 4px;
        font-size: 0.68rem;
        font-weight: 700;
        border: 1px solid #d8e6f8;
        background: #eef4ff;
        color: #26426b;
      }

      .footer {
        margin-top: 12px;
        text-align: center;
        color: var(--muted);
        font-size: 0.8rem;
      }

      .hidden {
        display: none !important;
      }

      @media (max-width: 980px) {
        .layout {
          grid-template-columns: 1fr;
        }

        .sidebar {
          position: static;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header class="hero">
        <div class="hero-head">
          <div>
            <h1>داشبورد گرافیکی اولویت‌های توسعه — Persian Tools</h1>
            <p>نمایش بصری وضعیت اولویت‌ها، تسک‌ها و مسیر اجرای توسعه.</p>
          </div>
          <span class="badge">Priority-Driven Execution</span>
        </div>

        <div class="controls">
          <button type="button" id="mark-all" class="btn-primary">علامت‌زدن همه</button>
          <button type="button" id="clear-all">پاک‌کردن همه</button>
          <button type="button" id="export-json">خروجی JSON</button>
          <button type="button" id="export-csv">خروجی CSV</button>
          <button type="button" id="import-json">ورودی JSON</button>
          <input type="search" id="search" placeholder="جست‌وجو در تسک‌ها..." />
          <div class="status-switch" aria-label="فیلتر وضعیت">
            <button type="button" class="status-btn active" data-status="all">همه</button>
            <button type="button" class="status-btn" data-status="open">باز</button>
            <button type="button" class="status-btn" data-status="done">انجام‌شده</button>
          </div>
        </div>

        <div class="snapshot-controls">
          <select id="snapshot-list">
            <option value="">انتخاب اسنپ‌شات ذخیره‌شده</option>
          </select>
          <input type="text" id="snapshot-name" placeholder="نام اسنپ‌شات (مثلاً: بسته شدن Priority 4)" />
          <button type="button" id="save-snapshot">ذخیره اسنپ‌شات</button>
          <button type="button" id="load-snapshot">بارگذاری اسنپ‌شات</button>
          <button type="button" id="delete-snapshot">حذف اسنپ‌شات</button>
        </div>

        <div class="filters" id="tag-filters"></div>

        <section class="dashboard" aria-label="آمار کلی">
          <article class="kpi">
            <div class="kpi-title">پیشرفت کل</div>
            <div class="kpi-value" id="stats-percent">0%</div>
            <div class="kpi-progress" aria-hidden="true"><span id="progress-bar"></span></div>
          </article>
          <article class="kpi">
            <div class="kpi-title">تسک‌های قابل‌نمایش</div>
            <div class="kpi-value" id="stats-text">0 / 0</div>
          </article>
          <article class="kpi">
            <div class="kpi-title">تسک‌های باز</div>
            <div class="kpi-value" id="stats-open">0</div>
          </article>
          <article class="kpi">
            <div class="kpi-title">تسک‌های انجام‌شده</div>
            <div class="kpi-value" id="stats-done">0</div>
          </article>
        </section>
      </header>

      <main class="layout">
        <aside class="sidebar" aria-label="ناوبری اولویت‌ها">
          <h3>مرور سریع توسعه</h3>
          <div class="phase-nav" id="phase-nav"></div>
        </aside>

        <section class="board-wrap">
              <section class="board" id="board">
      <div class="column" data-phase="اولویت 1">
        <h2>اولویت 1 — کیفیت و زیرساخت</h2>
        <div class="task" data-tags="کیفیت" data-phase="اولویت 1">
          <input type="checkbox" id="p1-1" checked />
          <label for="p1-1">همگام‌سازی نسخه‌های Node/TS/Tooling <span class="tag">کیفیت</span><span class="meta">اولویت 1</span></label>
        </div>
        <div class="task" data-tags="کیفیت" data-phase="اولویت 1">
          <input type="checkbox" id="p1-2" checked />
          <label for="p1-2">تعریف gate کیفیت: lint, format, typecheck, coverage <span class="tag">کیفیت</span><span class="meta">اولویت 1</span></label>
        </div>
        <div class="task" data-tags="تست" data-phase="اولویت 1">
          <input type="checkbox" id="p1-3" checked />
          <label for="p1-3">تکمیل تست‌های واحد ابزارهای کلیدی <span class="tag">تست</span><span class="meta">اولویت 1</span></label>
        </div>
        <div class="task" data-tags="CI" data-phase="اولویت 1">
          <input type="checkbox" id="p1-4" checked />
          <label for="p1-4">بهبود CI برای سناریوهای حیاتی <span class="tag">CI</span><span class="meta">اولویت 1</span></label>
        </div>
      </div>

      <div class="column" data-phase="اولویت 2">
        <h2>اولویت 2 — تجربه کاربری</h2>
        <div class="task" data-tags="UX" data-phase="اولویت 2">
          <input type="checkbox" id="p2-1" checked />
          <label for="p2-1">بهینه‌سازی صفحه اصلی و CTAها <span class="tag">UX</span><span class="meta">اولویت 2</span></label>
        </div>
        <div class="task" data-tags="فرم" data-phase="اولویت 2">
          <input type="checkbox" id="p2-2" checked />
          <label for="p2-2">استانداردسازی فرم‌ها، خطاها و empty/loading <span class="tag">فرم</span><span class="meta">اولویت 2</span></label>
        </div>
        <div class="task" data-tags="دسترس‌پذیری" data-phase="اولویت 2">
          <input type="checkbox" id="p2-3" checked />
          <label for="p2-3">بهبود دسترس‌پذیری مسیرهای اصلی <span class="tag">دسترس‌پذیری</span><span class="meta">اولویت 2</span></label>
        </div>
        <div class="task" data-tags="متن" data-phase="اولویت 2">
          <input type="checkbox" id="p2-4" checked />
          <label for="p2-4">بازبینی microcopyهای فارسی <span class="tag">متن</span><span class="meta">اولویت 2</span></label>
        </div>
        <div class="task" data-tags="Admin,UX" data-phase="اولویت 2">
          <input type="checkbox" id="p2-5" checked />
          <label for="p2-5">افزودن banner راهنمای fallback ENV برای نبود DB در `admin/site-settings` <span class="tag">Admin</span><span class="tag">UX</span><span class="meta">اولویت 2</span></label>
        </div>
        <div class="task" data-tags="Admin,UX" data-phase="اولویت 2">
          <input type="checkbox" id="p2-6" checked />
          <label for="p2-6">رفع race بارگذاری اولیه فرم `admin/site-settings` برای پایداری ذخیره `developerName` <span class="tag">Admin</span><span class="tag">UX</span><span class="meta">اولویت 2</span></label>
        </div>
      </div>

      <div class="column" data-phase="اولویت 3">
        <h2>اولویت 3 — کتابخانه و API</h2>
        <div class="task" data-tags="API" data-phase="اولویت 3">
          <input type="checkbox" id="p3-1" checked />
          <label for="p3-1">تثبیت APIهای shared/utils <span class="tag">API</span><span class="meta">اولویت 3</span></label>
        </div>
        <div class="task" data-tags="کارایی" data-phase="اولویت 3">
          <input type="checkbox" id="p3-2" checked />
          <label for="p3-2">lazy‑load واقعی برای ماژول‌های سنگین <span class="tag">کارایی</span><span class="meta">اولویت 3</span></label>
        </div>
        <div class="task" data-tags="مستندات" data-phase="اولویت 3">
          <input type="checkbox" id="p3-3" checked />
          <label for="p3-3">بهبود مستندات API با نمونه‌های واقعی <span class="tag">مستندات</span><span class="meta">اولویت 3</span></label>
        </div>
      </div>

      <div class="column" data-phase="اولویت 4">
        <h2>اولویت 4 — تجربه کاربری و دسترس‌پذیری</h2>
        <div class="task" data-tags="UX,AsyncState" data-phase="اولویت 4">
          <input type="checkbox" id="p4-1" checked />
          <label for="p4-1">یکپارچه‌سازی `AsyncState` در `account/history` <span class="tag">UX</span><span class="tag">AsyncState</span><span class="meta">اولویت 4</span></label>
        </div>
        <div class="task" data-tags="UX,AsyncState" data-phase="اولویت 4">
          <input type="checkbox" id="p4-2" checked />
          <label for="p4-2">گسترش `AsyncState` به `loan/salary/date-tools/text-tools` <span class="tag">UX</span><span class="tag">AsyncState</span><span class="meta">اولویت 4</span></label>
        </div>
        <div class="task" data-tags="تست,Regression" data-phase="اولویت 4">
          <input type="checkbox" id="p4-3" checked />
          <label for="p4-3">تست‌های regression برای stateهای خطا/خالی/مجاز نبودن <span class="tag">تست</span><span class="tag">Regression</span><span class="meta">اولویت 4</span></label>
        </div>
        <div class="task" data-tags="E2E,Retry" data-phase="اولویت 4">
          <input type="checkbox" id="p4-4" checked />
          <label for="p4-4">سناریوهای E2E retry برای `account/history/date-tools` <span class="tag">E2E</span><span class="tag">Retry</span><span class="meta">اولویت 4</span></label>
        </div>
        <div class="task" data-tags="PWA,E2E" data-phase="اولویت 4">
          <input type="checkbox" id="p4-5" checked />
          <label for="p4-5">پایدارسازی تست‌های آفلاین با helper مشترک PWA <span class="tag">PWA</span><span class="tag">E2E</span><span class="meta">اولویت 4</span></label>
        </div>
        <div class="task" data-tags="امنیت,تست" data-phase="اولویت 4">
          <input type="checkbox" id="p4-6" checked />
          <label for="p4-6">افزودن guardrail تست CSP برای `unsafe-eval` فقط non-prod <span class="tag">امنیت</span><span class="tag">تست</span><span class="meta">اولویت 4</span></label>
        </div>
        <div class="task" data-tags="دسترس‌پذیری,QA" data-phase="اولویت 4">
          <input type="checkbox" id="p4-7" checked />
          <label for="p4-7">پایش مستمر WCAG AA در مسیرهای پرترافیک <span class="tag">دسترس‌پذیری</span><span class="tag">QA</span><span class="meta">اولویت 4</span></label>
        </div>
        <div class="task" data-tags="UX,استانداردسازی" data-phase="اولویت 4">
          <input type="checkbox" id="p4-8" checked />
          <label for="p4-8">گسترش الگوی state مشترک به سایر ابزارهای باقی‌مانده <span class="tag">UX</span><span class="tag">استانداردسازی</span><span class="meta">اولویت 4</span></label>
        </div>
        <div class="task" data-tags="E2E,Admin" data-phase="اولویت 4">
          <input type="checkbox" id="p4-9" checked />
          <label for="p4-9">افزودن E2E برای `admin/site-settings` (load/save/invalid-url/footer reflection) <span class="tag">E2E</span><span class="tag">Admin</span><span class="meta">اولویت 4</span></label>
        </div>
        <div class="task" data-tags="E2E,Stability" data-phase="اولویت 4">
          <input type="checkbox" id="p4-10" checked />
          <label for="p4-10">پاس کامل full-suite کرومیوم با فلگ‌های `E2E_ADMIN_BACKEND=1` و `E2E_RETRY_BACKEND=1` <span class="tag">E2E</span><span class="tag">Stability</span><span class="meta">اولویت 4</span></label>
        </div>
        <div class="task" data-tags="Test,Regression" data-phase="اولویت 4">
          <input type="checkbox" id="p4-11" checked />
          <label for="p4-11">افزودن تست واحد load-race برای فرم `admin/site-settings` و پایداری `developerName` <span class="tag">Test</span><span class="tag">Regression</span><span class="meta">اولویت 4</span></label>
        </div>
        <div class="task" data-tags="Test,Stability" data-phase="اولویت 4">
          <input type="checkbox" id="p4-12" checked />
          <label for="p4-12">کاهش نویز warningهای `act(...)` در تست race ادمین با حفظ spy سراسری setup تست <span class="tag">Test</span><span class="tag">Stability</span><span class="meta">اولویت 4</span></label>
        </div>
      </div>

      <div class="column" data-phase="اولویت 5">
        <h2>اولویت 5 — مستندات و مشارکت</h2>
        <div class="task" data-tags="مستندات" data-phase="اولویت 5">
          <input type="checkbox" id="t1" />
          <label for="t1">بازآرایی README/CONTRIBUTING <span class="tag">مستندات</span><span class="meta">اولویت 5</span></label>
        </div>
        <div class="task" data-tags="استاندارد" data-phase="اولویت 5">
          <input type="checkbox" id="t2" />
          <label for="t2">افزودن راهنمای توسعه ابزارها و استانداردهای UI <span class="tag">استاندارد</span><span class="meta">اولویت 5</span></label>
        </div>
        <div class="task" data-tags="مشارکت" data-phase="اولویت 5">
          <input type="checkbox" id="t3" />
          <label for="t3">تعریف مسیرهای مشارکت روشن <span class="tag">مشارکت</span><span class="meta">اولویت 5</span></label>
        </div>
        <div class="task" data-tags="مستندات" data-phase="اولویت 5">
          <input type="checkbox" id="t5a" checked />
          <label for="t5a">انتشار پلی‌بوک Codex Cloud در `docs/codex-audit-playbook.md` <span class="tag">مستندات</span><span class="meta">اولویت 5</span></label>
        </div>
      </div>

      <div class="column" data-phase="اولویت 6">
        <h2>اولویت 6 — گام‌های عملی پس از ممیزی</h2>
        <div class="task" data-tags="SEO" data-phase="اولویت 6">
          <input type="checkbox" id="t4" />
          <label for="t4">اجرای Lighthouse موبایل برای ۵ صفحه کلیدی (خارج از ریپو) <span class="tag">SEO</span><span class="meta">اولویت 6</span></label>
        </div>
        <div class="task" data-tags="RTL" data-phase="اولویت 6">
          <input type="checkbox" id="t5" checked />
          <label for="t5">رفع خطاهای فاصله RTL با کلاس‌های منطقی <span class="tag">RTL</span><span class="meta">اولویت 6</span></label>
        </div>
        <div class="task" data-tags="CI,SEO" data-phase="اولویت 6">
          <input type="checkbox" id="t5b" checked />
          <label for="t5b">فعالسازی Lighthouse CI روی push/PR با آستانه perf/SEO/AA <span class="tag">CI</span><span class="tag">SEO</span><span class="meta">اولویت 6</span></label>
        </div>
        <div class="task" data-tags="کیفیت" data-phase="اولویت 6">
          <input type="checkbox" id="t5c" checked />
          <label for="t5c">رفع خطاهای lint باقی‌مانده برای سبز شدن `pnpm lint` <span class="tag">کیفیت</span><span class="meta">اولویت 6</span></label>
        </div>
        <div class="task" data-tags="SEO" data-phase="اولویت 6">
          <input type="checkbox" id="t5d" checked />
          <label for="t5d">ثبت اسنپ‌شات Lighthouse/CI در `docs/snapshots/2026-02-06-lighthouse-ci-setup.md` <span class="tag">SEO</span><span class="meta">اولویت 6</span></label>
        </div>
        <div class="task" data-tags="Artifact,Validation" data-phase="اولویت 6">
          <input type="checkbox" id="t5e" checked />
          <label for="t5e">افزودن artifact و validator قرارداد `site-settings` <span class="tag">Artifact</span><span class="tag">Validation</span><span class="meta">اولویت 6</span></label>
        </div>
        <div class="task" data-tags="CI,Validation" data-phase="اولویت 6">
          <input type="checkbox" id="t5f" checked />
          <label for="t5f">اتصال گیت سبک `ci:contracts` به CI اصلی برای validatorها و SW contract <span class="tag">CI</span><span class="tag">Validation</span><span class="meta">اولویت 6</span></label>
        </div>
      </div>

      <div class="column" data-phase="اولویت 7">
        <h2>اولویت 7 — درآمدزایی کم‌ریسک</h2>
        <div class="task" data-tags="درآمد" data-phase="اولویت 7">
          <input type="checkbox" id="t6" checked />
          <label for="t6">افزودن تبلیغات استاتیک و اسپانسر مستقیم <span class="tag">درآمد</span><span class="meta">اولویت 7</span></label>
        </div>
        <div class="task" data-tags="درآمد" data-phase="اولویت 7">
          <input type="checkbox" id="p7-3a" checked />
          <label for="p7-3a">ثبت نمایش/کلیک در تحلیل‌گر داخلی <span class="tag">درآمد</span><span class="meta">اولویت 7</span></label>
        </div>
        <div class="task" data-tags="درآمد" data-phase="اولویت 7">
          <input type="checkbox" id="p7-3b" checked />
          <label for="p7-3b">انتشار اعلامیه رسمی درباره مدل درآمدی و شفافیت <span class="tag">درآمد</span><span class="meta">اولویت 7</span></label>
        </div>
      </div>

      <div class="column" data-phase="اولویت 8">
        <h2>اولویت 8 — بهینه‌سازی کنترل‌شده</h2>
        <div class="task" data-tags="UX" data-phase="اولویت 8">
          <input type="checkbox" id="t7" checked />
          <label for="t7">اجرای A/B تست داخلی برای سنجش تاثیر بر UX <span class="tag">UX</span><span class="meta">اولویت 8</span></label>
        </div>
        <div class="task" data-tags="عملیات" data-phase="اولویت 8">
          <input type="checkbox" id="t8" checked />
          <label for="t8">پایش بازخورد کاربران و اصلاح سیاست‌ها <span class="tag">عملیات</span><span class="meta">اولویت 8</span></label>
        </div>
        <div class="task" data-tags="درآمد" data-phase="اولویت 8">
          <input type="checkbox" id="p5-1" checked />
          <label for="p5-1">بهینه‌سازی جایگاه تبلیغات براساس داده‌های داخلی <span class="tag">درآمد</span><span class="meta">اولویت 8</span></label>
        </div>
        <div class="task" data-tags="درآمد" data-phase="اولویت 8">
          <input type="checkbox" id="p5-2" checked />
          <label for="p5-2">ارزیابی تبلیغات زمینه‌ای با Opt‑in <span class="tag">درآمد</span><span class="meta">اولویت 8</span></label>
        </div>
        <div class="task" data-tags="عملیات" data-phase="اولویت 8">
          <input type="checkbox" id="p5-3" checked />
          <label for="p5-3">ارزیابی حفظ کاربر و نرخ تبدیل اشتراک <span class="tag">عملیات</span><span class="meta">اولویت 8</span></label>
        </div>
      </div>

      <div class="column" data-phase="اولویت 9">
        <h2>اولویت 9 — عملیات و پایداری</h2>
        <div class="task" data-tags="عملیات" data-phase="اولویت 9">
          <input type="checkbox" id="t9" checked />
          <label for="t9">گزارش‌دهی ماهانه درآمد و هزینه‌کرد <span class="tag">عملیات</span><span class="meta">اولویت 9</span></label>
        </div>
        <div class="task" data-tags="عملیات" data-phase="اولویت 9">
          <input type="checkbox" id="t10" checked />
          <label for="t10">بازنگری فصلی مدل درآمدی براساس KPIها <span class="tag">درآمد</span><span class="meta">اولویت 9</span></label>
        </div>
        <div class="task" data-tags="عملیات" data-phase="اولویت 9">
          <input type="checkbox" id="p6-1" checked />
          <label for="p6-1">به‌روزرسانی دوره‌ای صفحه شفافیت و حامیان <span class="tag">عملیات</span><span class="meta">اولویت 9</span></label>
        </div>
        <div class="task" data-tags="امنیت" data-phase="اولویت 9">
          <input type="checkbox" id="p6-2" checked />
          <label for="p6-2">بازبینی امنیت پنل ادمین و لاگ‌های حساس <span class="tag">امنیت</span><span class="meta">اولویت 9</span></label>
        </div>
        <div class="task" data-tags="عملیات" data-phase="اولویت 9">
          <input type="checkbox" id="p6-3" checked />
          <label for="p6-3">بهینه‌سازی هزینه ذخیره‌سازی و سیاست حذف تاریخچه <span class="tag">عملیات</span><span class="meta">اولویت 9</span></label>
        </div>
        <div class="task" data-tags="مشارکت" data-phase="اولویت 9">
          <input type="checkbox" id="p6-4" checked />
          <label for="p6-4">ایجاد کانال ارتباطی اختصاصی برای مشترکان <span class="tag">مشارکت</span><span class="meta">اولویت 9</span></label>
        </div>
      </div>

      <div class="column" data-phase="اولویت 10">
        <h2>اولویت 10 — مقیاس‌پذیری و اتوماسیون درآمد</h2>
        <div class="task" data-tags="عملیات" data-phase="اولویت 10">
          <input type="checkbox" id="p7-1" checked />
          <label for="p7-1">تعریف چرخه بسته‌شدن ماهانه/فصلی با Owner و SLA روشن <span class="tag">عملیات</span><span class="meta">اولویت 10</span></label>
        </div>
        <div class="task" data-tags="اتوماسیون" data-phase="اولویت 10">
          <input type="checkbox" id="p7-2" checked />
          <label for="p7-2">خودکارسازی تولید گزارش KPI از داده‌های داخلی <span class="tag">اتوماسیون</span><span class="meta">اولویت 10</span></label>
        </div>
        <div class="task" data-tags="هشدار" data-phase="اولویت 10">
          <input type="checkbox" id="p7-3" checked />
          <label for="p7-3">تعریف آستانه‌های هشدار برای افت KPIهای حیاتی <span class="tag">هشدار</span><span class="meta">اولویت 10</span></label>
        </div>
        <div class="task" data-tags="تصمیم‌گیری" data-phase="اولویت 10">
          <input type="checkbox" id="p7-4" checked />
          <label for="p7-4">استانداردسازی Playbook تصمیم‌گیری scale/hold/rollback <span class="tag">تصمیم‌گیری</span><span class="meta">اولویت 10</span></label>
        </div>
        <div class="task" data-tags="حریم خصوصی" data-phase="اولویت 10">
          <input type="checkbox" id="p7-5" checked />
          <label for="p7-5">پایش ریسک‌های حریم خصوصی در سناریوهای رشد <span class="tag">حریم خصوصی</span><span class="meta">اولویت 10</span></label>
        </div>
      </div>

      <div class="column" data-phase="اولویت 11">
        <h2>اولویت 11 — آماده‌سازی استقرار</h2>
        <div class="task" data-tags="DevOps" data-phase="اولویت 11">
          <input type="checkbox" id="p8-1" checked />
          <label for="p8-1">ستاپ متغیرهای محیطی و secrets روی سرور (Production/Staging) <span class="tag">DevOps</span><span class="meta">استقرار</span></label>
        </div>
        <div class="task" data-tags="PWA" data-phase="اولویت 11">
          <input type="checkbox" id="p8-2" checked />
          <label for="p8-2">بررسی `CACHE_VERSION` و تست آپدیت Service Worker در محیط staging <span class="tag">PWA</span><span class="meta">استقرار</span></label>
        </div>
        <div class="task" data-tags="QA" data-phase="اولویت 11">
          <input type="checkbox" id="p8-3" checked />
          <label for="p8-3">اجرای `pnpm build`, `pnpm test`, `pnpm lighthouse:ci` روی build RC <span class="tag">QA</span><span class="meta">استقرار</span></label>
        </div>
        <div class="task" data-tags="امنیت" data-phase="اولویت 11">
          <input type="checkbox" id="p8-4" checked />
          <label for="p8-4">تایید CSP/HSTS و هدرهای امنیتی از مستندات operations <span class="tag">امنیت</span><span class="meta">استقرار</span></label>
        </div>
        <div class="task" data-tags="استقرار" data-phase="اولویت 11">
          <input type="checkbox" id="p8-5" checked />
          <label for="p8-5">تهیه تگ/Release کاندید و انتشار PR نهایی استقرار <span class="tag">استقرار</span><span class="meta">استقرار</span></label>
        </div>
      </div>

      <div class="column" data-phase="اولویت 12">
        <h2>اولویت 12 — اتوماسیون RC و Rollback</h2>
        <div class="task" data-tags="Release" data-phase="اولویت 12">
          <input type="checkbox" id="p12-1" checked />
          <label for="p12-1">تعریف artifact قراردادی RC checklist <span class="tag">Release</span><span class="meta">اولویت 12</span></label>
        </div>
        <div class="task" data-tags="CI" data-phase="اولویت 12">
          <input type="checkbox" id="p12-2" checked />
          <label for="p12-2">اجرای خودکار RC gates و تولید گزارش release <span class="tag">CI</span><span class="meta">اولویت 12</span></label>
        </div>
        <div class="task" data-tags="Recovery" data-phase="اولویت 12">
          <input type="checkbox" id="p12-3" checked />
          <label for="p12-3">تعریف artifact و validator برای rollback drill <span class="tag">Recovery</span><span class="meta">اولویت 12</span></label>
        </div>
        <div class="task" data-tags="QA" data-phase="اولویت 12">
          <input type="checkbox" id="p12-4" checked />
          <label for="p12-4">افزودن تست قراردادی برای RC/rollback/report <span class="tag">QA</span><span class="meta">اولویت 12</span></label>
        </div>
      </div>

      <div class="column" data-phase="اولویت 13">
        <h2>اولویت 13 — آمادگی روز لانچ</h2>
        <div class="task" data-tags="Release" data-phase="اولویت 13">
          <input type="checkbox" id="p13-1" checked />
          <label for="p13-1">تعریف artifact قراردادی launch-day checklist <span class="tag">Release</span><span class="meta">اولویت 13</span></label>
        </div>
        <div class="task" data-tags="QA" data-phase="اولویت 13">
          <input type="checkbox" id="p13-2" checked />
          <label for="p13-2">اعتبارسنجی قرارداد launch-day (`pnpm release:launch:validate`) <span class="tag">QA</span><span class="meta">اولویت 13</span></label>
        </div>
        <div class="task" data-tags="CI" data-phase="اولویت 13">
          <input type="checkbox" id="p13-3" checked />
          <label for="p13-3">اجرای launch smoke (`pnpm release:launch:run`) و تولید report <span class="tag">CI</span><span class="meta">اولویت 13</span></label>
        </div>
        <div class="task" data-tags="Artifact" data-phase="اولویت 13">
          <input type="checkbox" id="p13-4" checked />
          <label for="p13-4">افزودن تست قراردادی checklist/report روز لانچ <span class="tag">Artifact</span><span class="meta">اولویت 13</span></label>
        </div>
      </div>
    </section>

        </section>
      </main>

      <div class="footer">منبع: `docs/roadmap.md`</div>
    </div>

    <script>
      const STORAGE_KEY = 'persian-tools.roadmap.v1';
      const SNAPSHOT_KEY = 'persian-tools.roadmap.snapshots.v1';
      const checkboxes = Array.from(document.querySelectorAll('input[type="checkbox"]'));
      const tasks = Array.from(document.querySelectorAll('.task'));
      const columns = Array.from(document.querySelectorAll('.column'));
      const searchInput = document.getElementById('search');
      const filtersRoot = document.getElementById('tag-filters');
      const phaseNavRoot = document.getElementById('phase-nav');
      const statsText = document.getElementById('stats-text');
      const statsOpen = document.getElementById('stats-open');
      const statsDone = document.getElementById('stats-done');
      const statsPercent = document.getElementById('stats-percent');
      const progressBar = document.getElementById('progress-bar');
      const snapshotNameInput = document.getElementById('snapshot-name');
      const snapshotList = document.getElementById('snapshot-list');
      const statusButtons = Array.from(document.querySelectorAll('.status-btn'));

      let activeTag = 'همه';
      let activeStatus = 'all';
      let activePhase = 'همه';

      function readSnapshots() {
        try {
          const raw = localStorage.getItem(SNAPSHOT_KEY);
          return raw ? JSON.parse(raw) : {};
        } catch {
          return {};
        }
      }

      function writeSnapshots(next) {
        localStorage.setItem(SNAPSHOT_KEY, JSON.stringify(next));
        refreshSnapshotList();
      }

      function refreshSnapshotList() {
        const snapshots = readSnapshots();
        const names = Object.keys(snapshots).sort();
        snapshotList.innerHTML = '<option value="">انتخاب اسنپ‌شات ذخیره‌شده</option>';
        names.forEach((name) => {
          const opt = document.createElement('option');
          opt.value = name;
          opt.textContent = name;
          snapshotList.appendChild(opt);
        });
      }

      function loadState() {
        try {
          const raw = localStorage.getItem(STORAGE_KEY);
          if (!raw) return;
          const state = JSON.parse(raw);
          checkboxes.forEach((box) => {
            box.checked = Boolean(state[box.id]);
          });
        } catch {
          // ignore
        }
      }

      function captureState() {
        const state = {};
        checkboxes.forEach((box) => {
          state[box.id] = box.checked;
        });
        return state;
      }

      function saveState() {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(captureState()));
        applyFilters();
      }

      function tasksToCsv() {
        const header = ['id', 'title', 'tags', 'phase', 'done'];
        const rows = tasks.map((task) => {
          const box = task.querySelector('input[type="checkbox"]');
          const label = task.querySelector('label');
          const title = (label ? label.childNodes[0].textContent : '').trim();
          return [
            box ? box.id : '',
            title,
            task.dataset.tags || '',
            task.dataset.phase || '',
            box && box.checked ? 'true' : 'false',
          ];
        });
        return [header, ...rows]
          .map((row) => row.map((cell) => `"${String(cell).replace(/"/g, '""')}"`).join(','))
          .join('\n');
      }

      function saveSnapshot() {
        const name = snapshotNameInput.value.trim();
        if (!name) return;
        const snapshots = readSnapshots();
        snapshots[name] = { savedAt: new Date().toISOString(), state: captureState() };
        writeSnapshots(snapshots);
        snapshotList.value = name;
      }

      function loadSnapshotByName(name) {
        if (!name) return;
        const snapshots = readSnapshots();
        const snapshot = snapshots[name];
        if (!snapshot) return;
        const state = snapshot.state || {};
        checkboxes.forEach((box) => {
          if (box.id in state) box.checked = Boolean(state[box.id]);
        });
        saveState();
      }

      function deleteSnapshot() {
        const name = snapshotNameInput.value.trim();
        if (!name) return;
        const snapshots = readSnapshots();
        if (!snapshots[name]) return;
        delete snapshots[name];
        writeSnapshots(snapshots);
        snapshotNameInput.value = '';
      }

      function buildTagFilters() {
        const tags = new Set(['همه']);
        tasks.forEach((task) => {
          const raw = task.dataset.tags || '';
          raw.split(',').forEach((tag) => {
            const next = tag.trim();
            if (next) tags.add(next);
          });
        });

        filtersRoot.innerHTML = '';
        Array.from(tags).forEach((tag) => {
          const btn = document.createElement('button');
          btn.type = 'button';
          btn.className = 'filter-btn' + (tag === activeTag ? ' active' : '');
          btn.textContent = tag;
          btn.addEventListener('click', () => {
            activeTag = tag;
            Array.from(filtersRoot.querySelectorAll('.filter-btn')).forEach((b) =>
              b.classList.remove('active'),
            );
            btn.classList.add('active');
            applyFilters();
          });
          filtersRoot.appendChild(btn);
        });
      }

      function buildPhaseNav() {
        phaseNavRoot.innerHTML = '';

        const allBtn = document.createElement('button');
        allBtn.type = 'button';
        allBtn.className = 'phase-btn' + (activePhase === 'همه' ? ' active' : '');
        allBtn.innerHTML = '<span>همه اولویت‌ها</span><span class="count" id="phase-all-count">0/0</span>';
        allBtn.addEventListener('click', () => {
          activePhase = 'همه';
          buildPhaseNav();
          applyFilters();
        });
        phaseNavRoot.appendChild(allBtn);

        columns.forEach((column) => {
          const phase = column.dataset.phase || '';
          const button = document.createElement('button');
          button.type = 'button';
          button.className = 'phase-btn' + (activePhase === phase ? ' active' : '');
          button.innerHTML = `<span>${phase}</span><span class="count">0/0</span>`;
          button.addEventListener('click', () => {
            activePhase = phase;
            buildPhaseNav();
            applyFilters();
            column.scrollIntoView({ behavior: 'smooth', block: 'start' });
          });
          phaseNavRoot.appendChild(button);
        });
      }

      function updateColumnStats() {
        const phaseSummary = {};

        columns.forEach((column) => {
          const phase = column.dataset.phase || '';
          const phaseTasks = tasks.filter((task) => task.dataset.phase === phase);
          const visible = phaseTasks.filter((task) => !task.classList.contains('hidden'));
          const done = visible.filter((task) => {
            const box = task.querySelector('input[type="checkbox"]');
            return box && box.checked;
          }).length;
          const total = visible.length;
          const percent = total === 0 ? 0 : Math.round((done / total) * 100);

          const countEl = column.querySelector('.phase-count');
          const progressEl = column.querySelector('.mini-progress > span');
          if (countEl) countEl.textContent = `${done}/${total}`;
          if (progressEl) progressEl.style.width = `${percent}%`;

          phaseSummary[phase] = { done, total };
        });

        const navButtons = Array.from(phaseNavRoot.querySelectorAll('.phase-btn'));
        navButtons.forEach((button, index) => {
          const count = button.querySelector('.count');
          if (!count) return;
          if (index === 0) {
            const totalTasks = tasks.filter((task) => !task.classList.contains('hidden')).length;
            const totalDone = tasks.filter((task) => {
              if (task.classList.contains('hidden')) return false;
              const box = task.querySelector('input[type="checkbox"]');
              return box && box.checked;
            }).length;
            count.textContent = `${totalDone}/${totalTasks}`;
            return;
          }
          const phase = button.querySelector('span')?.textContent || '';
          const summary = phaseSummary[phase];
          count.textContent = summary ? `${summary.done}/${summary.total}` : '0/0';
        });
      }

      function applyFilters() {
        const query = searchInput.value.trim();

        tasks.forEach((task) => {
          const text = task.textContent || '';
          const tags = (task.dataset.tags || '').split(',').map((item) => item.trim());
          const phase = task.dataset.phase || '';
          const box = task.querySelector('input[type="checkbox"]');
          const isDone = Boolean(box && box.checked);

          task.classList.toggle('done', isDone);

          const matchesQuery = !query || text.includes(query);
          const matchesTag = activeTag === 'همه' || tags.includes(activeTag);
          const matchesStatus =
            activeStatus === 'all' ||
            (activeStatus === 'done' && isDone) ||
            (activeStatus === 'open' && !isDone);
          const matchesPhase = activePhase === 'همه' || activePhase === phase;

          const visible = matchesQuery && matchesTag && matchesStatus && matchesPhase;
          task.classList.toggle('hidden', !visible);
        });

        columns.forEach((column) => {
          const visibleTasks = Array.from(column.querySelectorAll('.task')).filter(
            (task) => !task.classList.contains('hidden'),
          );
          column.classList.toggle('hidden', visibleTasks.length === 0);
        });

        const visibleTasks = tasks.filter((task) => !task.classList.contains('hidden'));
        const done = visibleTasks.filter((task) => {
          const box = task.querySelector('input[type="checkbox"]');
          return box && box.checked;
        }).length;
        const total = visibleTasks.length;
        const open = Math.max(total - done, 0);
        const percent = total === 0 ? 0 : Math.round((done / total) * 100);

        statsText.textContent = `${done} / ${total}`;
        statsOpen.textContent = `${open}`;
        statsDone.textContent = `${done}`;
        statsPercent.textContent = `${percent}%`;
        progressBar.style.width = `${percent}%`;

        updateColumnStats();
      }

      checkboxes.forEach((box) => {
        box.addEventListener('change', saveState);
      });

      statusButtons.forEach((button) => {
        button.addEventListener('click', () => {
          activeStatus = button.dataset.status || 'all';
          statusButtons.forEach((item) => item.classList.remove('active'));
          button.classList.add('active');
          applyFilters();
        });
      });

      document.getElementById('mark-all').addEventListener('click', () => {
        checkboxes.forEach((box) => {
          box.checked = true;
        });
        saveState();
      });

      document.getElementById('clear-all').addEventListener('click', () => {
        checkboxes.forEach((box) => {
          box.checked = false;
        });
        saveState();
      });

      document.getElementById('export-json').addEventListener('click', () => {
        const payload = { version: 1, updatedAt: new Date().toISOString(), state: captureState() };
        const blob = new Blob([JSON.stringify(payload, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const anchor = document.createElement('a');
        anchor.href = url;
        anchor.download = 'deployment-roadmap.json';
        anchor.click();
        URL.revokeObjectURL(url);
      });

      document.getElementById('export-csv').addEventListener('click', () => {
        const blob = new Blob([tasksToCsv()], { type: 'text/csv;charset=utf-8' });
        const url = URL.createObjectURL(blob);
        const anchor = document.createElement('a');
        anchor.href = url;
        anchor.download = 'deployment-roadmap.csv';
        anchor.click();
        URL.revokeObjectURL(url);
      });

      document.getElementById('import-json').addEventListener('click', () => {
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = 'application/json';
        input.addEventListener('change', () => {
          const file = input.files && input.files[0];
          if (!file) return;
          const reader = new FileReader();
          reader.onload = () => {
            try {
              const data = JSON.parse(String(reader.result || '{}'));
              const state = data.state || {};
              checkboxes.forEach((box) => {
                if (box.id in state) box.checked = Boolean(state[box.id]);
              });
              saveState();
            } catch {
              // invalid json
            }
          };
          reader.readAsText(file);
        });
        input.click();
      });

      document.getElementById('save-snapshot').addEventListener('click', saveSnapshot);
      document.getElementById('load-snapshot').addEventListener('click', () => {
        const name = snapshotNameInput.value.trim();
        loadSnapshotByName(name);
      });
      document.getElementById('delete-snapshot').addEventListener('click', deleteSnapshot);

      snapshotList.addEventListener('change', (event) => {
        const name = event.target.value;
        if (!name) return;
        snapshotNameInput.value = name;
        loadSnapshotByName(name);
      });

      searchInput.addEventListener('input', applyFilters);

      loadState();
      buildTagFilters();
      buildPhaseNav();
      refreshSnapshotList();
      applyFilters();
    </script>
  </body>
</html>
